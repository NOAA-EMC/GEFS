#! /usr/bin/env bash

#######################################################
# This file defines the various input varibles for Development Tests of GEFS
#######################################################
#
# Define DEVELOPMENT Enviorenmenat variables related to the TYPE of test 
export RUN_ENVIR=${RUN_ENVIR:-emc} # emc, nco based on g-w
export envir=${envir:-dev}
export NET=${NET:-gefs}
export RUN=${RUN:-gefs}
export SENDDBN=${SENDDBN:-NO}
export SENDDBN_NTC=${SENDDBN_NTC:-NO}

export PARAFLAG=${PARAFLAG:-YES}
export SENDECF=${SENDECF:-NO}
export SENDCOM=${SENDCOM:-YES}
export KEEPDATA=${KEEPDATA:-YES}

# Enviorenmenat variables related to Development work place and output files
#
export COMROOT=${WORKDIR}/${envir}/com
export DATAROOT=$baseoutput/tmp

export archsyndir=${archsyndir:-$COMROOTp1/arch/prod/syndat}
export DBNROOT=

export HOMEgefs=$basesource
export HOMEtrak=${HOMEtrak:-$HOMERFC/ens_tracker.v1.1.13}
export HOMEgfs=${HOMEgfs:-${HOMEDIR:-${HOMEgefs}}}
export HOMEgsi=${HOMEgfs:-$HOMEgfs}
export HOMEwave=${HOMEwave:-$HOMEgfs}
export HOMEpost=${HOMEpost:-$HOMEgfs}

if [[ ! -d $SOURCEDIR/sorc/global-workflow.fd ]] ; then
  export EXECwave=${HOMEgefs}/exec

  export FCSTEXECDIR=${FCSTEXECDIR:-$HOMEgfs/sorc/fv3gfs.fd/NEMS/exe}
  export HOMEchem=${HOMEchem:-$HOMEgfs/sorc/gsd_prep_chem.fd/workflow/emc-global}
fi

#Please check with parm/gefs_init.parm to make sure the next line matching
fhrp=6
export pdycycp=$($NDATE -$fhrp $PDY$cyc)
export pdyp=$(echo $pdycycp|cut -c1-8)
export cycp=$(echo $pdycycp|cut -c9-10)

# HOMEdata, COMINgfs_base, COMINenkf_base and COMINcfs_base are defined in setbase, pointing to the NCO  gfs.v15 parallel
# However, if you use gfs/enkf data from archived data, you may speficfy them in this "if" block and make GFSArchivedData=yes
if [[ $WHERE_AM_I == "hera" ]]; then
  source dev/versions/run_hera.ver
  export HOMEdata=/scratch2/NCEPDEV/ensemble/noscrub/Xianwu.Xue/GEFS_v13/z_DATA/lfs_C96_C48_NOIAU_anal_20230114/h1/ops/prod/com
  export COMINgfs_base=${HOMEdata}/gfs/${gfs_ver}
  export COMINenkfgfs=${COMINenkfgfs:-${COMINgfs_base}/enkfgfs.${PDY}/${cyc}}

  export COMINcfs_base=${HOMEdata}/com/cfs/v2.3/cfs.
  export DCOMROOT=$HOMEdata/dcom

  # For gempak_meta
  export COMINsgfs=${COMINgfs_base}
  export COMINnawips="NONE" #${COMINnawips:-$(compath.py nawips/prod)}
  export COMINecmwf="NONE" #${COMINecmwf:-$(compath.py ecmwf/prod/ecmwf)}
  export COMINukmet="NONE"  #${COMINukmet:-$(compath.py nawips/prod/ukmet)}
  export COMINnam="NONE" #${COMINnam:-$(compath.py nam/prod)}

  export COMIN_WAV_ICE=$COMINgfs
  export COMINenkf=${COMINenkf:-${COMINenkf_base}}
  export COMINcfs=${COMINcfs:-${COMINcfs_base}}
fi
