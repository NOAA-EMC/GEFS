#!/bin/sh
#PBS -N jgefs_chem_prep_emissions_00
##PBS -o /lfs/h2/emc/ptmp/Xianwu.Xue/o/gefs_port2wcoss2/com/output/dev/20210731/jgefs_chem_prep_emissions_00.%J
#PBS -j oe
#PBS -l select=1:ncpus=56:mem=50GB
##PBS -R span[ptile=28]
##PBS -R 'affinity[core(1)]'
#PBS -q workq
#PBS -l walltime=0:15:00
##45:00
##PBS -L /bin/sh
#PBS -A GEN-T2O

set -x

cd $PBS_O_WORKDIR

#module purge

export model=gefs

# to get HOMEgefs
f=lsf_common.sh
if [[ -f "$f" ]]; then
    echo "$f exists."
    source $f
elif [[ -f "../$f" ]]; then
    echo "../$f exists."
    source ../$f
elif [[ -f "../../$f" ]]; then
    echo "../../$f exists."
    source ../../$f
elif [[ -f "../../../$f" ]]; then
    echo "../../../$f exists."
    source ../../../$f
fi
. ${HOMEgefs}/versions/run.ver

module purge
module load envvar/$envvar_ver
module load PrgEnv-intel/$prgenv_intel_ver
module load craype/$craype_ver
module load intel/$intel_ver

module load prod_util/$prod_util_ver
module load prod_envir/$prod_envir_ver

module load netcdf/$netcdf_ver
module load hdf5/$hdf5_ver
#module load lsf/$lsf_ver

module list

# EXPORT list here
ulimit -s unlimited
ulimit -a

export fhmaxh="96"
export fhmax_aer="60"
export fhrestart="9999"

f=lsf_common.sh
if [[ -f "$f" ]]; then
    echo "$f exists."
    source $f
elif [[ -f "../$f" ]]; then
    echo "../$f exists."
    source ../$f
elif [[ -f "../../$f" ]]; then
    echo "../../$f exists."
    source ../../$f
elif [[ -f "../../../$f" ]]; then
    echo "../../../$f exists."
    source ../../../$f
fi

#HOMEdata=/lfs/h2/emc/ens/noscrub/Xianwu.Xue/gefs/HOMEdata
#export DCOMROOT=${HOMEdata}/canned/dcom

#export npert=2
#export navg_min=1
#export cyc=00
#export PDY=20200509

export total_tasks=1
export OMP_NUM_THREADS=28
export taskspernode=1

# CALL executable job script here
${HOMEgefs}/jobs/JGEFS_CHEM_PREP_EMISSIONS
