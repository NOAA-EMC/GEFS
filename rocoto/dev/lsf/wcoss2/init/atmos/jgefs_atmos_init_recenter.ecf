#!/bin/sh
#PBS -N jgefs_atmos_init_recenter_00
##PBS -o /lfs/h2/emc/ptmp/Xianwu.Xue/o/gefs_port2wcoss2/com/output/dev/20210731/jgefs_atmos_init_recenter_00.%J
#PBS -j oe
#PBS -l select=1:ncpus=12:mem=50GB
##PBS -R span[ptile=6]
##PBS -R 'affinity[core(1)]'
#PBS -q workq
#PBS -l walltime=0:30:00
##PBS -L /bin/sh
#PBS -A GEN-T2O

set -x

cd $PBS_O_WORKDIR

module purge

export model=gefs
export HOMEgefs=${HOMEgefs:-/lfs/h2/emc/ens/noscrub/Xianwu.Xue/gefs/gefs_port2wcoss2}
. ${HOMEgefs}/versions/run.ver

module load envvar/$envvar_ver
module load PrgEnv-intel/$prgenv_intel_ver
module load craype/$craype_ver
module load intel/$intel_ver

module load cray-mpich/$cray_mpich_ver
module load cray-pals/$cray_pals_ver

module load prod_util/$prod_util_ver
module load prod_envir/$prod_envir_ver

#module load lsf/$lsf_ver
module load python/$python_ver
module load cfp/$cfp_ver
export USE_CFP=YES

module list

# EXPORT list here
ulimit -s unlimited
ulimit -a

export cyc=00
export PDY=20210731

export GEFS_ROCOTO=${HOMEgefs}/rocoto

#. $GEFS_ROCOTO/bin/wcoss2/common.sh
#====
HOMEdata=/lfs/h2/emc/ens/noscrub/Xianwu.Xue/gefs/HOMEdata/com
export COMINgfs_base=${HOMEdata}/gfs/prod/gfs.
export COMINenkf_base=${HOMEdata}/gfs/prod/enkfgdas.
export COMINcfs_base=${HOMEdata}/cfs/prod/cfs/cfs.
export COMINgfs=${COMINgfs:-${COMINgfs_base}${PDY}/$cyc/atmos}
export COMINenkf=${COMINenkf:-${COMINenkf_base}${pdyp}/$cycp/atmos}

export COMIN_WAV_ICE=$COMINgfs
export COMINenkf=${COMINenkf:-${COMINenkf_base}}
export COMINcfs=${COMINcfs:-${COMINcfs_base}}
#===

export OMP_NUM_THREADS=1

export job=${job:-$PBS_JOBNAME}
export HOMEgefs=${HOMEgefs:-/lfs/h2/emc/ens/noscrub/Xianwu.Xue/gefs/gefs_port2wcoss2}
export WORKDIR=/lfs/h2/emc/ptmp/Xianwu.Xue/o/gefs_port2wcoss2
export COMROOT=${WORKDIR}/com
export GESROOT=${WORKDIR}/nwges
export DATAROOT=${WORKDIR}/tmp
export envir=${envir:-dev}
export RUN_ENVIR=${RUN_ENVIR:-dev}
export SENDCOM=YES
export KEEPDATA=YES     # ecflow NO
export SENDECF=NO       # ecflow YES
export SENDDBN=NO       # ecflow YES
export SENDDBN_NTC=NO   # ecflow YES
export npert=2
#export navg_min=1
#export cyc=00
#export PDY=20200509

export total_tasks=6
export taskspernode=6

export gefsmpexec_mpmd="mpiexec -n $total_tasks --ppn $taskspernode cfp mpmd_cmdfile"
# "mpirun -n $total_tasks cfp mpmd_cmdfile"


# CALL executable job script here
${HOMEgefs}/jobs/JGEFS_ATMOS_INIT_RECENTER
